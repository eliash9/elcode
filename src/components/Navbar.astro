---
import ThemeToggle from "./ThemeToggle.astro";
const links = [
  { href: '/#tutorial', label: 'Tutorial' },
  { href: '/#konsep', label: 'Konsep' },
  { href: '/#berita', label: 'Berita' },
  { href: '/#proyek', label: 'Proyek' },
  { href: '/about', label: 'About' },
  { href: '/contact', label: 'Contact' },
];
const pathname = Astro.url.pathname || '/';
---
<header class="sticky top-0 z-40 border-b border-white/10 glass">
  <nav aria-label="Navigasi utama" class="container-px mx-auto flex h-16 items-center justify-between">
    <a href="/" class="flex items-center gap-2 text-white font-extrabold tracking-tight" aria-label="Beranda ELCODE">
      <span class="inline-flex h-8 w-8 items-center justify-center rounded-xl bg-brand text-white">
        <!-- Simple code bracket icon -->
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="h-5 w-5" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M8 8L4 12l4 4M16 8l4 4-4 4" />
        </svg>
      </span>
      <span class="text-lg">ELCODE</span>
    </a>

    <button id="nav-toggle" class="md:hidden text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-white/50 rounded-md p-2" aria-controls="main-menu" aria-expanded="false" aria-label="Toggle menu">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="h-6 w-6"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/></svg>
    </button>

    <ul id="main-menu" class="hidden md:flex gap-1 text-sm">
      {links.map(({ href, label }) => {
        const isActive = pathname === href;
        return (
          <li>
            <a
              href={href}
              aria-current={isActive ? 'page' : undefined}
              class={`text-white/90 hover:text-white rounded-full px-3 py-2 transition-colors ${isActive ? 'bg-white/10' : ''}`}
            >{label}</a>
          </li>
        );
      })}
    </ul>
    <div class="hidden md:block">
      <ThemeToggle />
    </div>
  </nav>
  <div id="mobile-panel" class="md:hidden hidden border-t border-white/10 bg-[#0B1220]">
    <ul class="container-px mx-auto py-2 grid grid-cols-2 gap-2">
      {links.map(({ href, label }) => (
        <li>
          <a href={href} class="block text-white/90 hover:text-white rounded-xl px-3 py-2 transition-colors">{label}</a>
        </li>
      ))}
      <li class="col-span-2 flex justify-end">
        <ThemeToggle />
      </li>
    </ul>
  </div>
  <script>
    const btn = document.getElementById('nav-toggle');
    const panel = document.getElementById('mobile-panel');
    const menu = document.getElementById('main-menu');
    btn?.addEventListener('click', () => {
      const expanded = btn.getAttribute('aria-expanded') === 'true';
      btn.setAttribute('aria-expanded', String(!expanded));
      panel?.classList.toggle('hidden');
    });
    // Close mobile on nav link click
    panel?.querySelectorAll('a')?.forEach(a => a.addEventListener('click', () => {
      btn.setAttribute('aria-expanded', 'false');
      panel.classList.add('hidden');
    }));
    // Opaque glass on scroll
    const header = document.querySelector('header.glass');
    const onScroll = () => {
      if (!header) return;
      const y = window.scrollY || document.documentElement.scrollTop;
      header.classList.toggle('glass-opaque', y > 8);
    };
    onScroll();
    window.addEventListener('scroll', onScroll, { passive: true });
  </script>
</header>
